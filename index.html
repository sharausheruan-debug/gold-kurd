<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2489/2489756.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ• | Ø¯Û†Ù„Ø§Ø± Ùˆ Ø¯ÛŒÙ†Ø§Ø±</title>
    <style>
        :root {
            --gold: #d4af37; --bg: #0d0d0d; --card: #1a1a1a;
            --input-bg: #000; --text: #fff; --up: #00ff88; --down: #ff4d4d;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; }
        .box { background: var(--card); padding: 25px; border-radius: 30px; width: 100%; max-width: 420px; border: 1px solid rgba(212, 175, 55, 0.2); box-shadow: 0 30px 60px rgba(0,0,0,0.7); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h2 { color: var(--gold); margin: 0; font-size: 26px; }
        
        .api-status { font-size: 10px; color: #555; margin-top: 5px; cursor: pointer; border: 1px solid #333; display: inline-block; padding: 2px 8px; border-radius: 10px; transition: 0.3s; }
        .api-status:active { transform: scale(0.95); background: #222; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 12px; background: var(--input-bg); color: #fff; font-size: 16px; text-align: center; outline: none; box-sizing: border-box; }
        input:focus { border-color: var(--gold); }

        .results { border-radius: 20px; overflow: hidden; background: rgba(0,0,0,0.3); }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #222; }
        .row.active { background: rgba(212, 175, 55, 0.1); border-right: 4px solid var(--gold); }
        
        .price-container { text-align: left; display: flex; flex-direction: column; align-items: flex-end; }
        .val-iqd { font-family: 'Consolas', monospace; font-size: 16px; font-weight: bold; transition: color 0.5s; }
        .val-usd { font-family: 'Consolas', monospace; font-size: 13px; color: var(--gold); opacity: 0.8; margin-top: 2px; }

        .trend-up { color: var(--up) !important; }
        .trend-down { color: var(--down) !important; }

        .share-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-outline { background: #333; color: var(--gold); }
    </style>
</head>
<body>

<div class="box">
    <div class="header">
        <h2>Ø¨Û†Ø±Ø³Û•ÛŒ Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†</h2>
        <p id="live-clock" style="font-size: 12px; color: #666; margin: 5px 0;">--:--:--</p>
        <div id="api-btn" class="api-status" onclick="fetchGoldPrice()">Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Ø±Ø® (Live) ğŸ”„</div>
    </div>

    <div class="grid">
        <div>
            <label>Ø¦Û†Ù†Ø³Û• ($)</label>
            <input type="number" id="ounce" step="any" oninput="update()">
        </div>
        <div>
            <label>Ù¡Ù Ù  Ø¯Û†Ù„Ø§Ø± (Ø¯ÛŒÙ†Ø§Ø±)</label>
            <input type="number" id="dollar" step="any" oninput="update()">
        </div>
        <div class="full-width">
            <label>Ø­Û•ÙˆØ§ÚµÛ•/Ù…Û•Ø³Ø±Û•Ù ($)</label>
            <input type="number" id="premium" value="81" oninput="update()">
        </div>
    </div>

    <div class="results">
        <div class="row">
            <span>Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤:</span>
            <div class="price-container">
                <span class="val-iqd" id="v24-iqd">0 Ø¯.Ú©</span>
                <span class="val-usd" id="v24-usd">$0.00</span>
            </div>
        </div>
        <div class="row active">
            <span style="color: var(--gold); font-weight: bold;">Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡:</span>
            <div class="price-container">
                <span class="val-iqd" id="v21-iqd">0 Ø¯.Ú©</span>
                <span class="val-usd" id="v21-usd">$0.00</span>
            </div>
        </div>
        <div class="row">
            <span>Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨:</span>
            <div class="price-container">
                <span class="val-iqd" id="v18-iqd">0 Ø¯.Ú©</span>
                <span class="val-usd" id="v18-usd">$0.00</span>
            </div>
        </div>
    </div>

    <div class="share-group">
        <button class="btn btn-gold" onclick="copyRates()">Ú©Û†Ù¾ÛŒ Ù†Ø±Ø® ğŸ“‹</button>
        <button class="btn btn-outline" onclick="resetDefaults()">Reset ğŸ”„</button>
    </div>
</div>

<script>
    let lastM21 = 0;

    async function fetchGoldPrice() {
        const btn = document.getElementById('api-btn');
        btn.innerText = "Ø®Û•Ø±ÛŒÚ©ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†Û•...";
        try {
            const response = await fetch('https://api.gold-api.com/api/v1/gold');
            const data = await response.json();
            if(data && data.price) {
                document.getElementById('ounce').value = data.price.toFixed(2);
                update();
                btn.innerText = "Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âœ…";
            }
        } catch (e) { btn.innerText = "Ù‡Û•ÚµÛ• âŒ"; }
        setTimeout(() => btn.innerText = "Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Ø±Ø® (Live) ğŸ”„", 2000);
    }

    function update() {
        const ounce = parseFloat(document.getElementById('ounce').value) || 0;
        const dollar = parseFloat(document.getElementById('dollar').value) || 0;
        const premium = parseFloat(document.getElementById('premium').value) || 0;

        localStorage.setItem('data', JSON.stringify({ounce, dollar, premium}));

        if (ounce > 0 && dollar > 0) {
            const priceInUSD = (ounce + premium) / 31.10347 * 5; 
            const m24_usd = priceInUSD;
            const m21_usd = m24_usd * 0.875;
            const m18_usd = m24_usd * 0.75;

            // Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯ÛŒÙ†Ø§Ø±
            const exchangeRate = dollar / 100;
            const m24_iqd = m24_usd * exchangeRate;
            const m21_iqd = m21_usd * exchangeRate;
            const m18_iqd = m18_usd * exchangeRate;

            // Trend indicator
            handleTrend('v21-iqd', m21_iqd, lastM21);
            lastM21 = m21_iqd;

            // Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù† Ù„Û• Ø´Ø§Ø´Û•
            display('v24', m24_iqd, m24_usd);
            display('v21', m21_iqd, m21_usd);
            display('v18', m18_iqd, m18_usd);
        }
    }

    function display(id, iqd, usd) {
        document.getElementById(id + '-iqd').innerText = (Math.round(iqd / 250) * 250).toLocaleString() + " Ø¯.Ú©";
        document.getElementById(id + '-usd').innerText = "$" + usd.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    function handleTrend(id, newVal, oldVal) {
        const el = document.getElementById(id);
        if (oldVal > 0) {
            el.classList.remove('trend-up', 'trend-down');
            if (newVal > oldVal) el.classList.add('trend-up');
            else if (newVal < oldVal) el.classList.add('trend-down');
            setTimeout(() => el.classList.remove('trend-up', 'trend-down'), 1000);
        }
    }

    function copyRates() {
        const t = `ğŸ“Š Ù†Ø±Ø®Û•Ú©Ø§Ù†ÛŒ Ø²ÛÚ•:\nØ¹Û•ÛŒØ§Ø± Ù¢Ù¡: ${document.getElementById('v21-iqd').innerText} (${document.getElementById('v21-usd').innerText})\nØ¨Û†Ø±Ø³Û•ÛŒ Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†`;
        navigator.clipboard.writeText(t);
        alert("Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§!");
    }

    function resetDefaults() { if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØŸ")) { localStorage.clear(); location.reload(); } }

    setInterval(() => { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-GB'); }, 1000);

    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('data'));
        if(saved) {
            document.getElementById('ounce').value = saved.ounce;
            document.getElementById('dollar').value = saved.dollar;
            document.getElementById('premium').value = saved.premium;
        } else {
            document.getElementById('ounce').value = "2350";
            document.getElementById('dollar').value = "150000";
        }
        update();
        fetchGoldPrice();
    };
</script>
</body>
</html>
